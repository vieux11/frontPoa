<div class="max-w-md mx-auto mt-10 p-6 bg-white shadow rounded">
  <h2 class="text-2xl font-bold mb-4 text-center">Créer un événement</h2>

  <!-- Erreur API/Network -->
  @if (submitted && apiError) {
    <div class="mb-4 p-3 bg-red-100 text-red-800 rounded flex justify-between items-center">
      <strong>{{ apiError }}</strong>
      <button (click)="closeError()" class="text-xl font-bold px-2">&times;</button>
    </div>
  }

  <form [formGroup]="eventForm" (ngSubmit)="handleSubmit()" novalidate>
    <!-- Titre -->
    <div class="mb-4">
      <label class="block text-gray-700">Titre *</label>
      <input 
        type="text" 
        formControlName="title" 
        class="w-full border border-[#A03473] p-2 rounded mt-1"
        [class.border-red-500]="eventForm.get('title')?.invalid && eventForm.get('title')?.touched" 
      />
      @if (eventForm.get('title')?.invalid && eventForm.get('title')?.touched) {
        <div class="text-red-500 text-sm mt-1">
          @if (eventForm.get('title')?.errors?.['required']) {
            <p>Le titre est obligatoire.</p>
          }
          @if (eventForm.get('title')?.errors?.['minlength']) {
            <p>5 caractères minimum.</p>
          }
        </div>
      }
    </div>

    <!-- Description -->
    <div class="mb-4">
      <label class="block text-gray-700">Description *</label>
      <textarea 
        formControlName="description" 
        class="w-full border border-[#A03473] p-2 rounded mt-1"
        [class.border-red-500]="eventForm.get('description')?.invalid && eventForm.get('description')?.touched"
      ></textarea>
      @if (eventForm.get('description')?.invalid && eventForm.get('description')?.touched) {
        <div class="text-red-500 text-sm mt-1">
          @if (eventForm.get('description')?.errors?.['required']) {
            <p>La description est obligatoire.</p>
          }
          @if (eventForm.get('description')?.errors?.['minlength']) {
            <p>10 caractères minimum.</p>
          }
        </div>
      }
    </div>
    <!-- Lieu -->
      <div class="mb-4">
        <label class="block text-gray-700">Lieu *</label>
        <input 
          type="text" 
          formControlName="location" 
          class="w-full border p-2 rounded mt-1"
          [class.border-red-500]="eventForm.get('location')?.invalid && eventForm.get('location')?.touched" 
        />
        @if (eventForm.get('location')?.invalid && eventForm.get('location')?.touched) {
          <div class="text-red-500 text-sm mt-1">
            @if (eventForm.get('location')?.errors?.['required']) {
              <p>Le lieu est obligatoire.</p>
            }
          </div>
        }
      </div>

    <!-- Date + Heure -->
    <div class="grid grid-cols-2 gap-4 mb-4">
      <div>
        <label class="block text-gray-700">Date *</label>
        <input 
          type="date" 
          formControlName="eventDate" 
          class="w-full border border-[#A03473] p-2 rounded mt-1"
          [class.border-red-500]="eventForm.get('eventDate')?.invalid && eventForm.get('eventDate')?.touched" 
        />
        @if (eventForm.get('eventDate')?.invalid && eventForm.get('eventDate')?.touched) {
          <div class="text-red-500 text-sm mt-1">
            @if (eventForm.get('eventDate')?.errors?.['required']) {
              <p>La date est obligatoire.</p>
            }
            @if (eventForm.get('eventDate')?.errors?.['pastDate']) {
              <p>La date doit être dans le futur.</p>
            }
          </div>
        }
      </div>
      <div>
        <label class="block text-gray-700">Heure *</label>
        <input 
          type="time" 
          formControlName="heure" 
          class="w-full border p-2 rounded mt-1"
          [class.border-red-500]="eventForm.get('heure')?.invalid && eventForm.get('heure')?.touched" 
        />
        @if (eventForm.get('heure')?.invalid && eventForm.get('heure')?.touched) {
          <div class="text-red-500 text-sm mt-1">
            @if (eventForm.get('heure')?.errors?.['required']) {
              <p>L'heure est obligatoire.</p>
            }
          </div>
        }
      </div>
    </div>

    <!-- Max Participants -->
    <div class="mb-4">
      <label class="block text-gray-700">Participants max *</label>
      <input 
        type="number" 
        formControlName="maxParticipants" 
        class="w-full border border-[#A03473] p-2 rounded mt-1"
        [class.border-red-500]="eventForm.get('maxParticipants')?.invalid && eventForm.get('maxParticipants')?.touched" 
      />
      @if (eventForm.get('maxParticipants')?.invalid && eventForm.get('maxParticipants')?.touched) {
        <div class="text-red-500 text-sm mt-1">
          @if (eventForm.get('maxParticipants')?.errors?.['required']) {
            <p>Ce champ est obligatoire.</p>
          }
          @if (eventForm.get('maxParticipants')?.errors?.['min']) {
            <p>Doit être supérieur à 0.</p>
          }
        </div>
      }
    </div>

    <!-- Image -->
    <div class="mb-4">
        <label class="block text-gray-700">Image</label>
        <div class="relative">
          <input 
            type="file" 
            (change)="onFileSelected($event)"
            accept="image/*"
            class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
            #fileInput
          />
          <div class="flex items-center border border-[#A03473] rounded p-2">
            <span class="flex-1 truncate">
              {{ fileName || 'Sélectionner une image' }}
            </span>
            <button 
              type="button" 
              class="ml-2 px-2 py-1 bg-gray-100 rounded hover:bg-gray-200"
              (click)="fileInput.click()"
            >
              Parcourir
            </button>
          </div>
        </div>
        @if (imageError) {
          <div class="text-red-500 text-sm mt-1">
            {{ imageError }}
          </div>
        }
      </div>

    <button 
      type="submit" 
      class="w-full bg-[#A03473] text-white py-2 rounded hover:bg-[#88175a] transition cursor-pointer"
    >
      Créer l’événement
    </button>
  </form>
</div>